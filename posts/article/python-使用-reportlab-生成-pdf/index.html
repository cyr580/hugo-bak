<!doctype html><html lang=en-us dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="https://blog.csdn.net/wolanx/article/details/122828185  Intro #  项目中遇到需要 导出统计报表 等业务时，通常需要 pdf 格式。python 中比较有名的就是 reportlab 。 这边通过几个小 demo 快速演示常用 api。所有功能点 源码 都在 使用场景。
 一句话了解：跟 css 差不多，就是不断地对每样东西设置 style，然后把 style 和内容绑定。
 功能点 #   生成  文件： 先 SimpleDocTemplate(&lsquo;xxx.pdf&rsquo;)，然后 build 流文件：先 io.BytesIO() 生成句柄，然后同理   曲线图 LinePlot 饼图 Pie 文字 Paragraph  fontSize 字体大小 推荐 14 加粗 <b>xxx</b> 使用的是 html 的方式，字体自动实现 firstLineIndent 首行缩进 推荐 2 * fontSize leading 行间距 推荐 1.5 * fontSize fontName 默认中文会变成 ■  下载 .">
<meta name=theme-color content="#FFFFFF">
<meta name=color-scheme content="light dark"><meta property="og:title" content="python 使用 reportlab 生成 pdf">
<meta property="og:description" content="https://blog.csdn.net/wolanx/article/details/122828185  Intro #  项目中遇到需要 导出统计报表 等业务时，通常需要 pdf 格式。python 中比较有名的就是 reportlab 。 这边通过几个小 demo 快速演示常用 api。所有功能点 源码 都在 使用场景。
 一句话了解：跟 css 差不多，就是不断地对每样东西设置 style，然后把 style 和内容绑定。
 功能点 #   生成  文件： 先 SimpleDocTemplate(&lsquo;xxx.pdf&rsquo;)，然后 build 流文件：先 io.BytesIO() 生成句柄，然后同理   曲线图 LinePlot 饼图 Pie 文字 Paragraph  fontSize 字体大小 推荐 14 加粗 <b>xxx</b> 使用的是 html 的方式，字体自动实现 firstLineIndent 首行缩进 推荐 2 * fontSize leading 行间距 推荐 1.5 * fontSize fontName 默认中文会变成 ■  下载 .">
<meta property="og:type" content="article">
<meta property="og:url" content="https://wolanx.com/posts/article/python-%E4%BD%BF%E7%94%A8-reportlab-%E7%94%9F%E6%88%90-pdf/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-02-09T15:30:51+08:00">
<meta property="article:modified_time" content="2022-02-09T15:30:51+08:00">
<title>python 使用 reportlab 生成 pdf | wolanx</title>
<link rel=manifest href=/manifest.json>
<link rel=icon href=/favicon.png type=image/x-icon>
<link rel=stylesheet href=/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css integrity="sha256-gsXb0jRHzuC0wqo+0Izglh+qQOH6Nw7uT4yfAuDUa18=" crossorigin=anonymous>
<script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.df7cd563e18b31b0fe3891fa05707e910ba3c4bb46d82aeb2b975391619c45d3.js integrity="sha256-33zVY+GLMbD+OJH6BXB+kQujxLtG2CrrK5dTkWGcRdM=" crossorigin=anonymous></script>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/><span>wolanx</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li>
<a href=/posts/>
Blog
</a>
</li>
<li>
<a href=/projects/>
Project
</a>
</li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>python 使用 reportlab 生成 pdf</strong>
<label for=toc-control>
<img src=/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li><a href=#intro>Intro</a></li>
<li><a href=#功能点>功能点</a></li>
<li><a href=#预览>预览</a></li>
<li><a href=#完整代码>完整代码</a></li>
<li><a href=#使用场景1生成文件>使用场景1：生成文件</a></li>
<li><a href=#使用场景2webflask>使用场景2：web（flask）</a></li>
</ul>
</nav>
</aside>
</header>
<article class=markdown>
<h1>
<a href=/posts/article/python-%E4%BD%BF%E7%94%A8-reportlab-%E7%94%9F%E6%88%90-pdf/>python 使用 reportlab 生成 pdf</a>
</h1>
<h5>2022-02-09 15:30:51</h5>
<div>
<a href=/categories/csdn/>csdn</a>
</div>
<blockquote>
<p><a href=https://blog.csdn.net/wolanx/article/details/122828185 target=_blank>https://blog.csdn.net/wolanx/article/details/122828185</a>
</p>
</blockquote>
<h2 id=intro>
Intro
<a class=anchor href=#intro>#</a>
</h2>
<p>项目中遇到需要 <code>导出统计报表</code> 等业务时，通常需要 <code>pdf</code> 格式。<code>python</code> 中比较有名的就是 <code>reportlab</code> 。
这边通过几个小 demo 快速演示常用 api。所有功能点 <code>源码</code> 都在 <code>使用场景</code>。</p>
<blockquote>
<p>一句话了解：跟 css 差不多，就是不断地对每样东西设置 style，然后把 style 和内容绑定。</p>
</blockquote>
<h2 id=功能点>
功能点
<a class=anchor href=#%e5%8a%9f%e8%83%bd%e7%82%b9>#</a>
</h2>
<ul>
<li>生成
<ul>
<li>文件： 先 SimpleDocTemplate(&lsquo;xxx.pdf&rsquo;)，然后 build</li>
<li>流文件：先 io.BytesIO() 生成句柄，然后同理</li>
</ul>
</li>
<li>曲线图 <code>LinePlot</code></li>
<li>饼图 <code>Pie</code></li>
<li>文字 <code>Paragraph</code>
<ul>
<li>fontSize 字体大小 推荐 14</li>
<li>加粗 <code>&lt;b>xxx&lt;/b></code> 使用的是 html 的方式，字体自动实现</li>
<li>firstLineIndent 首行缩进 推荐 2 * fontSize</li>
<li>leading 行间距 推荐 1.5 * fontSize</li>
<li>fontName 默认中文会变成 ■
<ul>
<li>下载 .ttf 文件 至少2个 【常规】【加粗】</li>
<li>注册字体 pdfmetrics.registerFont 【常规】请用原名，方便加粗的实现</li>
<li>注册字体库 registerFontFamily(&ldquo;HanSans&rdquo;, normal=&ldquo;HanSans&rdquo;, bold=&ldquo;HanSans-Bold&rdquo;)</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>其他 api 自行摸索，但基本离不开 css 那种理念。官网并没有常规文档的那种 md 模式，而是完全写在了 pdf 里，玩家需要自己去 pdf 里像查字典一样去找。<a href=https://www.reportlab.com/docs/reportlab-userguide.pdf target=_blank>官方文档</a>
</p>
</blockquote>
<h2 id=预览>
预览
<a class=anchor href=#%e9%a2%84%e8%a7%88>#</a>
</h2>
<p><img src="https://img-blog.csdnimg.cn/96e96089aad744db917372a1a1770785.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeXVqaWUuemhhbw==,size_12,color_FFFFFF,t_70,g_se,x_16#pic_center" alt=在这里插入图片描述></p>
<h2 id=完整代码>
完整代码
<a class=anchor href=#%e5%ae%8c%e6%95%b4%e4%bb%a3%e7%a0%81>#</a>
</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> os

<span style=color:#f92672>from</span> reportlab.graphics.charts.lineplots <span style=color:#f92672>import</span> LinePlot
<span style=color:#f92672>from</span> reportlab.graphics.charts.piecharts <span style=color:#f92672>import</span> Pie
<span style=color:#f92672>from</span> reportlab.graphics.shapes <span style=color:#f92672>import</span> Drawing
<span style=color:#f92672>from</span> reportlab.lib <span style=color:#f92672>import</span> colors
<span style=color:#f92672>from</span> reportlab.lib.styles <span style=color:#f92672>import</span> ParagraphStyle
<span style=color:#f92672>from</span> reportlab.pdfbase <span style=color:#f92672>import</span> pdfmetrics
<span style=color:#f92672>from</span> reportlab.pdfbase.pdfmetrics <span style=color:#f92672>import</span> registerFontFamily
<span style=color:#f92672>from</span> reportlab.pdfbase.ttfonts <span style=color:#f92672>import</span> TTFont
<span style=color:#f92672>from</span> reportlab.platypus <span style=color:#f92672>import</span> Paragraph

home <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>expanduser(<span style=color:#e6db74>&#34;~&#34;</span>)

<span style=color:#66d9ef>try</span>:
    pdfmetrics<span style=color:#f92672>.</span>registerFont(TTFont(<span style=color:#e6db74>&#34;HanSans&#34;</span>, <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>home<span style=color:#e6db74>}</span><span style=color:#e6db74>/.fonts/SourceHanSansCN-Normal.ttf&#34;</span>))
    pdfmetrics<span style=color:#f92672>.</span>registerFont(TTFont(<span style=color:#e6db74>&#34;HanSans-Bold&#34;</span>, <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>home<span style=color:#e6db74>}</span><span style=color:#e6db74>/.fonts/SourceHanSansCN-Bold.ttf&#34;</span>))
    registerFontFamily(<span style=color:#e6db74>&#34;HanSans&#34;</span>, normal<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;HanSans&#34;</span>, bold<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;HanSans-Bold&#34;</span>)
    FONT_NAME <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;HanSans&#34;</span>
<span style=color:#66d9ef>except</span>:
    FONT_NAME <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Helvetica&#34;</span>


<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyCSS</span>:
    h3 <span style=color:#f92672>=</span> ParagraphStyle(name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;h3&#34;</span>, fontName<span style=color:#f92672>=</span>FONT_NAME, fontSize<span style=color:#f92672>=</span><span style=color:#ae81ff>14</span>, leading<span style=color:#f92672>=</span><span style=color:#ae81ff>21</span>, alignment<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
    p <span style=color:#f92672>=</span> ParagraphStyle(name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;p&#34;</span>, fontName<span style=color:#f92672>=</span>FONT_NAME, fontSize<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>, leading<span style=color:#f92672>=</span><span style=color:#ae81ff>18</span>, firstLineIndent<span style=color:#f92672>=</span><span style=color:#ae81ff>24</span>)


<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PiiPdf</span>:
    <span style=color:#a6e22e>@classmethod</span>
    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>doH3</span>(cls, text: str):
        <span style=color:#66d9ef>return</span> Paragraph(text, MyCSS<span style=color:#f92672>.</span>h3)

    <span style=color:#a6e22e>@classmethod</span>
    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>doP</span>(cls, text: str):
        <span style=color:#66d9ef>return</span> Paragraph(text, MyCSS<span style=color:#f92672>.</span>p)

    <span style=color:#a6e22e>@classmethod</span>
    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>doLine</span>(cls):
        drawing <span style=color:#f92672>=</span> Drawing(<span style=color:#ae81ff>500</span>, <span style=color:#ae81ff>220</span>)
        line <span style=color:#f92672>=</span> LinePlot()
        line<span style=color:#f92672>.</span>x <span style=color:#f92672>=</span> <span style=color:#ae81ff>50</span>
        line<span style=color:#f92672>.</span>y <span style=color:#f92672>=</span> <span style=color:#ae81ff>50</span>
        line<span style=color:#f92672>.</span>height <span style=color:#f92672>=</span> <span style=color:#ae81ff>125</span>
        line<span style=color:#f92672>.</span>width <span style=color:#f92672>=</span> <span style=color:#ae81ff>300</span>
        line<span style=color:#f92672>.</span>lines[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>strokeColor <span style=color:#f92672>=</span> colors<span style=color:#f92672>.</span>blue
        line<span style=color:#f92672>.</span>lines[<span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>strokeColor <span style=color:#f92672>=</span> colors<span style=color:#f92672>.</span>red
        line<span style=color:#f92672>.</span>lines[<span style=color:#ae81ff>2</span>]<span style=color:#f92672>.</span>strokeColor <span style=color:#f92672>=</span> colors<span style=color:#f92672>.</span>green
        line<span style=color:#f92672>.</span>data <span style=color:#f92672>=</span> [((<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>50</span>), (<span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>100</span>), (<span style=color:#ae81ff>200</span>, <span style=color:#ae81ff>200</span>), (<span style=color:#ae81ff>250</span>, <span style=color:#ae81ff>210</span>), (<span style=color:#ae81ff>300</span>, <span style=color:#ae81ff>300</span>), (<span style=color:#ae81ff>400</span>, <span style=color:#ae81ff>800</span>))]

        drawing<span style=color:#f92672>.</span>add(line)
        <span style=color:#66d9ef>return</span> drawing

    <span style=color:#a6e22e>@classmethod</span>
    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>doChart</span>(cls, data):
        drawing <span style=color:#f92672>=</span> Drawing(width<span style=color:#f92672>=</span><span style=color:#ae81ff>500</span>, height<span style=color:#f92672>=</span><span style=color:#ae81ff>200</span>)
        pie <span style=color:#f92672>=</span> Pie()
        pie<span style=color:#f92672>.</span>x <span style=color:#f92672>=</span> <span style=color:#ae81ff>150</span>
        pie<span style=color:#f92672>.</span>y <span style=color:#f92672>=</span> <span style=color:#ae81ff>65</span>
        pie<span style=color:#f92672>.</span>sideLabels <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
        pie<span style=color:#f92672>.</span>labels <span style=color:#f92672>=</span> [letter <span style=color:#66d9ef>for</span> letter <span style=color:#f92672>in</span> <span style=color:#e6db74>&#34;abcdefg&#34;</span>]
        pie<span style=color:#f92672>.</span>data <span style=color:#f92672>=</span> data  <span style=color:#75715e># list(range(15, 105, 15))</span>
        pie<span style=color:#f92672>.</span>slices<span style=color:#f92672>.</span>strokeWidth <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.5</span>

        drawing<span style=color:#f92672>.</span>add(pie)
        <span style=color:#66d9ef>return</span> drawing
</code></pre></div><h2 id=使用场景1生成文件>
使用场景1：生成文件
<a class=anchor href=#%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af1%e7%94%9f%e6%88%90%e6%96%87%e4%bb%b6>#</a>
</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>doc <span style=color:#f92672>=</span> SimpleDocTemplate<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Hello.pdf&#34;</span><span style=color:#f92672>)</span>

p <span style=color:#f92672>=</span> PiiPdf<span style=color:#f92672>()</span>
doc.build<span style=color:#f92672>([</span>
    p.doH3<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;&lt;b&gt;水泵能源消耗简报&lt;/b&gt;&#34;</span><span style=color:#f92672>)</span>,
    p.doH3<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;&lt;b&gt;2021.12.1 ~ 2021.12.31&lt;/b&gt;&#34;</span><span style=color:#f92672>)</span>,
    p.doP<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;该月接入能耗管理系统水泵系统 xx 套，水泵 x 台。&#34;</span><span style=color:#f92672>)</span>,
    p.doP<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;本月最大总功率 xx kW，环比上月增加 xx %，平均功率 xx kW；环比上月增加 xx %。&#34;</span><span style=color:#f92672>)</span>,
    p.doP<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;功率消耗趋势图：&#34;</span><span style=color:#f92672>)</span>,
    p.doLine<span style=color:#f92672>()</span>,
    p.doP<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;本月总能耗 xxx kWh，环比上月增加 xx %。&#34;</span><span style=color:#f92672>)</span>,
    p.doP<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;分水泵能耗统计：&#34;</span><span style=color:#f92672>)</span>,
    p.doChart<span style=color:#f92672>(</span>list<span style=color:#f92672>(</span>range<span style=color:#f92672>(</span>15, 105, 20<span style=color:#f92672>)))</span>,
    p.doP<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;其中能耗最高的水泵为：xxx， 环比上月增加 xxx kWh，xx %。&#34;</span><span style=color:#f92672>)</span>,
<span style=color:#f92672>])</span>
</code></pre></div><h2 id=使用场景2webflask>
使用场景2：web（flask）
<a class=anchor href=#%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af2webflask>#</a>
</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a6e22e>@Controller</span><span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;/api/pdf&#34;</span>)
<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>api_hub_energy_pdf</span>():
    buffer <span style=color:#f92672>=</span> io<span style=color:#f92672>.</span>BytesIO()										<span style=color:#75715e># 重点 起一个 io</span>
    doc <span style=color:#f92672>=</span> SimpleDocTemplate(buffer)

    p <span style=color:#f92672>=</span> PiiPdf()
    doc<span style=color:#f92672>.</span>build([
        p<span style=color:#f92672>.</span>doH3(<span style=color:#e6db74>&#34;&lt;b&gt;2021.12.1 ~ 2021.12.31&lt;/b&gt;&#34;</span>),
    ])

    buffer<span style=color:#f92672>.</span>seek(<span style=color:#ae81ff>0</span>)
    <span style=color:#66d9ef>return</span> Response(											<span style=color:#75715e># io 形式返回</span>
        buffer,
        mimetype<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;application/pdf&#34;</span>,
        headers<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;Content-disposition&#34;</span>: <span style=color:#e6db74>&#34;inline; filename=test.pdf&#34;</span>},
    )
</code></pre></div></article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
<div>
<a class="flex align-center" href=https://github.com/wolanx/blog/edit/main/content/posts/article/python%20%e4%bd%bf%e7%94%a8%20reportlab%20%e7%94%9f%e6%88%90%20pdf.md target=_blank rel=noopener>
<img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span>
</a>
</div>
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<div class=book-comments>
</div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#intro>Intro</a></li>
<li><a href=#功能点>功能点</a></li>
<li><a href=#预览>预览</a></li>
<li><a href=#完整代码>完整代码</a></li>
<li><a href=#使用场景1生成文件>使用场景1：生成文件</a></li>
<li><a href=#使用场景2webflask>使用场景2：web（flask）</a></li>
</ul>
</nav>
</div>
</aside>
</main>
</body>
</html>